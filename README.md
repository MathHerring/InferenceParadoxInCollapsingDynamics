# InferenceParadoxInCollapsingDynamics

Code for paper "Inferring the Dynamics of Collapse" by Nicolas Lenner, Stephan Eule, Jörg Großhans, Fred Wolf and Matthias Häring

# Prerequisites
python dependencies:

- numpy
- scipy
- seaborn
- matplotlib
- dynesty
- sbi
- sdeint


# Contents

## Generating trajectories

TSA trajectories can be generated using our C code - wrapped in python - in the folder /generateTSAensemble/

Alternatively /pathinference_Fig6/Paperplots_Examplemodels_TrajectoriesANDinference.ipynb contains native (much slower) python code.




### Summary

This Python script serves as a wrapper to generate and process stochastic process simulation data by invoking an external C program (`prog` in `./generateTSAtrajectories/`). It runs simulations of stochastic differential equations with user-specified parameters, saves simulation results from the C code, and then extracts and saves summary statistics (mean, variance, and hitting time) into well-labeled output files for later analysis.

### Requirements

- `numpy` package.
- C executable `prog` must be compiled and present in the `./generateTSAtrajectories/` directory.
- Output files (`num_mean.txt`, `num_var.txt`, `hittingTime.txt`) must be generated by the C code.

### Usage

1. Make sure the C program is compiled and available as `./generateTSAtrajectories/prog`.
2. Adjust simulation parameters in the Python script as needed (e.g., `fit_until_this_t`, `nrealiz`, `gamma_ar`, `D_ar`, `alpha_ar`, `beta_ar`, etc.).
3. Run the Python script:
   ```bash
   python GenerateTSAEnsemble.py
   ```
4. After execution, the script will:
    - Call the external C program to generate simulation data.
    - Process and extract the mean, variance, and hitting times from output files.
    - Save these as new files labeled with the relevant parameter values.

### Output

Output files will be created in the working directory, named as:

- `mean_gamma*_D*_alpha*_beta*_N*_dt*.txt`
- `var_gamma*_D*_alpha*_beta*_N*_dt*.txt`
- `hittingtime_gamma*_D*_alpha*_beta*_N*_dt*.txt`

Each filename encodes the parameter values used for traceability.

**Note:**  
- This script is a wrapper for simulation workflows and does not perform the simulations internally—ensure the C code and its outputs are present.
- To extend for other parameter sets, edit the arrays at the top of the script.

# Simulation based inference

/sbi_Fig2/ contains scripts for training SBI estimators as well as code for plotting and prediction. We also combine nested sampling with the sbi-likelihood estimator to compute the evidence. Pretrained estimators for likelihood and posterior are included.

**Summary of Code and Usage Instructions**

This script performs parameter inference on stochastic process models using simulation-based inference (SBI). It uses externally compiled C++ code for simulating time series, loads results, and visualizes posterior distributions of model parameters.

### How to Use

1. **Requirements**:
   - Python 2 (code is Python 2 compatible, not Python 3 by default).
   - Libraries: `numpy`, `torch`, `matplotlib`, `seaborn`, `sbi`, `dynesty`, and available C++ simulation binary.
   - C++ simulation binary must be in `./generateTSAtrajectories/prog` and produce `num_mean.txt`, `num_var.txt`.

2. **Edit Parameters** *(optional)*:
   - Modify simulation settings (e.g., prior ranges, simulation time, or `true_params`) as needed.

3. **Run the Script**:
   - Execute via terminal:  
     ```
     python yourscript.py
     ```
   - Ensure all paths (C++ program, data files, posterior pickle) are correct.

4. **Results**:
   - Pairplots of posterior samples are saved as PDF and PNG files (e.g., `pairplot_WF.png`).

**Note:**  
- To perform new inference/training, you must generate a new posterior with SBI (`posterior__TSAalpbet_Nens5000_Ntrain10000_dt0005_untiltau02.pkl`).
- For medical or biological questions about the models, consult an expert.

**TL;DR:**
- Runs a C++ simulation for a stochastic model.
- Performs parameter inference using summary statistics and a pre-trained SBI posterior.
- Plots and saves posterior distributions for reproducibility or analysis.

**Theory figures**

Code for the Feller boundary classification plots, as well as code comparing reverse time theory with numerical simulations is given in /FellerClassification_Fig3/ and /TSAtheory_Fig4/. Only data file missing are the raw trajectories which must be generated with the code in /generateTSAensemble/. 

**Phasetransition**

Scripts for both entropy and squared coefficient of variation phasediagrams is given in /phasetransition_Fig5/ inlcuding most of the data needed to reproduce the plots. The scripts for cv and entropy generally only generate one datapoint of the respective diagram and have been evaluated on the cluster. 

The required trajectory data can be generated using the code given in GenerateTrajectories.py or alternatively with the code in /generateTSAensemble/.

**Reverse time inference**

In /pathinference_Fig6/ we showcase how to perform inference using our path inference formalism based on the reverse time theoretical framwork.


# Contributors

Matthias Häring - Göttingen Campus Institute For Dynamics Of Biological Networks

Nicolas Lenner - Institute For Advanced Study, Princeton

# Acknowledgements

For nested sampling inference we used dynesty: https://github.com/joshspeagle/dynesty

For simulation based inference we used sbi: https://github.com/sbi-dev/sbi
